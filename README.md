# envcraft

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                            â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
â•‘   â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â•šâ•â•â–ˆâ–ˆâ•”â•â•â•     â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•‘        â•‘
â•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•     â–ˆâ–ˆâ•‘        â•‘
â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘        â–ˆâ–ˆâ•‘        â•‘
â•‘   â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•â•  â•šâ•â•â•â•   â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â•â•šâ•â•        â•šâ•â•        â•‘
â•‘                                                                            â•‘
â•‘                      Precise tools for .env files                          â•‘
â•‘                                                                            â•‘
â•‘                      ğŸ¸ LazyFrog | kindware.dev                            â•‘
â•‘                                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

[![Rust](https://img.shields.io/badge/Rust-000000?style=for-the-badge&logo=rust&logoColor=white)](https://www.rust-lang.org/)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)
[![Tests](https://img.shields.io/badge/Tests-44%20Passing-brightgreen?style=for-the-badge)](https://github.com/Brutus1066/envcraft)
[![Windows](https://img.shields.io/badge/Windows-0078D6?style=for-the-badge&logo=windows&logoColor=white)](https://www.microsoft.com/windows)
[![Linux](https://img.shields.io/badge/Linux-FCC624?style=for-the-badge&logo=linux&logoColor=black)](https://www.linux.org/)
[![macOS](https://img.shields.io/badge/macOS-000000?style=for-the-badge&logo=apple&logoColor=white)](https://www.apple.com/macos)
[![crates.io](https://img.shields.io/badge/crates.io-e6522c?style=for-the-badge&logo=rust&logoColor=white)](https://crates.io/crates/envcraft)

---

## ğŸ¯ What is envcraft?

**envcraft** is a safe, deterministic CLI tool for working with `.env` files. It performs three operations with absolute precision:

| Command | Purpose |
|---------|---------|
| `check` | Validate a `.env` file against a YAML schema |
| `diff` | Show semantic differences between two `.env` files |
| `format` | Normalize and format a `.env` file |

## âœ¨ Features

- ğŸ”’ **Safe** â€” Never modifies secret values (only trims whitespace)
- ğŸ¯ **Deterministic** â€” Same input always produces same output
- ğŸš« **No AI** â€” No heuristics, no guessing, no surprises
- ğŸŒ **Offline** â€” No network access, no telemetry
- ğŸ–¥ï¸ **Cross-platform** â€” Works on Windows, Linux, and macOS
- ğŸ“¦ **Zero unsafe code** â€” Pure safe Rust

---

## ğŸ“¦ Installation

### From crates.io

```bash
cargo install envcraft
```

### From source

```bash
git clone https://github.com/Brutus1066/envcraft.git
cd envcraft
cargo build --release
```

The binary will be at `target/release/envcraft`.

---

## ğŸš€ Usage

### Check: Validate against a schema

```bash
envcraft check schema.yml .env
```

**Schema format (YAML):**

```yaml
PORT: int
DEBUG: bool
DATABASE_URL: string
API_KEY: string
```

**Supported types:**

| Type | Description | Valid examples |
|------|-------------|----------------|
| `string` | Any value | `hello`, `user@example.com` |
| `int` | Integer (i64) | `42`, `-10`, `8080` |
| `bool` | Boolean | `true`, `false`, `TRUE`, `FALSE` |

**Output:**

```
error: missing required key: API_KEY
error: key 'PORT' has invalid value 'abc' (expected an integer)
warning: extra key not in schema: LEGACY_MODE
âœ— validation failed with 2 error(s)
```

### Diff: Compare two files

```bash
envcraft diff .env.production .env.staging
```

**Output:**

```
+ NEW_FEATURE=enabled
- DEPRECATED_KEY=old_value
~ DATABASE_URL: prod-db â†’ staging-db
~ PORT: 80 â†’ 8080

4 difference(s) found
```

**Redact sensitive values:**

```bash
envcraft diff .env.production .env.staging --redact
```

**Output:**

```
+ NEW_FEATURE
- DEPRECATED_KEY
~ DATABASE_URL
~ PORT

4 difference(s) found
```

### Format: Normalize a file

```bash
envcraft format .env
```

**What it does:**

- âœ… Trims whitespace from keys and values
- âœ… Converts keys to UPPERCASE
- âœ… Normalizes format to `KEY=VALUE`
- âœ… Sorts keys alphabetically
- âœ… Preserves comments
- âŒ Never modifies actual values (except whitespace trimming)

**Modify in place:**

```bash
envcraft format .env --in-place
```

---

## ğŸ“‹ Demo

Try the included demo files to see envcraft in action:

### Validate a valid .env file

```bash
$ envcraft check demo/schema.yml demo/valid.env
âœ“ validation passed
```

### Validate an invalid .env file

```bash
$ envcraft check demo/schema.yml demo/invalid.env
error: missing required key: API_KEY
error: key 'DEBUG' has invalid value 'maybe' (expected true or false)
error: key 'PORT' has invalid value 'not_a_number' (expected an integer (e.g., 42, -10))
âœ— validation failed with 3 error(s)
```

### Diff between environments

```bash
$ envcraft diff demo/dev.env demo/prod.env
~ API_KEY: sk_dev_key â†’ sk_live_secret
+ CACHE_ENABLED=true
~ DATABASE_URL: postgres://localhost:5432/dev_db â†’ postgres://prod-server:5432/prod_db
~ DEBUG: true â†’ false
~ HOST: localhost â†’ 0.0.0.0
- LOG_LEVEL=debug
~ PORT: 3000 â†’ 80

7 difference(s) found
```

### Diff with redacted values

```bash
$ envcraft diff demo/dev.env demo/prod.env --redact
~ API_KEY
+ CACHE_ENABLED
~ DATABASE_URL
~ DEBUG
~ HOST
- LOG_LEVEL
~ PORT

7 difference(s) found
```

### Format a messy file

**Before (messy.env):**
```env
# Development environment

port = 3000
host=localhost
debug=true
database_url = postgres://localhost:5432/dev_db
api_key=sk_dev_xyz789
  extra_spaces  =   lots of whitespace   
```

**After:**
```bash
$ envcraft format demo/messy.env
# Development environment

API_KEY=sk_dev_xyz789
DATABASE_URL=postgres://localhost:5432/dev_db
DEBUG=true
EXTRA_SPACES=lots of whitespace
HOST=localhost
PORT=3000
```

---

## ğŸ“‹ Examples

### Example `.env` file

```env
# Database configuration
DATABASE_URL=postgres://localhost:5432/myapp

# Server settings
PORT=8080
DEBUG=false

# API keys
API_KEY=sk_live_abc123xyz
```

### Example schema

```yaml
# schema.yml
DATABASE_URL: string
PORT: int
DEBUG: bool
API_KEY: string
```

---

## ğŸ”’ Trust & Safety

**envcraft** is designed with security in mind:

| Guarantee | Description |
|-----------|-------------|
| ğŸš« No network access | The tool never makes HTTP requests |
| ğŸš« No telemetry | No data is collected or transmitted |
| ğŸš« No AI/heuristics | Behavior is 100% deterministic |
| ğŸš« No secret analysis | Values are treated as opaque strings |
| âœ… Whitespace only | The only modification to values is trimming |
| âœ… Offline operation | Works without internet connection |
| âœ… Open source | Full source code available for audit |

---

## ğŸ› ï¸ Building

```bash
# Debug build
cargo build

# Release build (optimized)
cargo build --release

# Run tests
cargo test

# Run with verbose test output
cargo test -- --nocapture
```

---

## ğŸ§ª Tests

envcraft includes comprehensive test coverage:

```
running 32 tests
test cli::tests::verify_cli ... ok
test diff::tests::test_diff_added ... ok
test diff::tests::test_diff_changed ... ok
test diff::tests::test_diff_complex ... ok
test diff::tests::test_diff_format_normal ... ok
test diff::tests::test_diff_format_redacted ... ok
test diff::tests::test_diff_identical ... ok
test diff::tests::test_diff_removed ... ok
test format::tests::test_format_complex ... ok
test format::tests::test_format_empty_value ... ok
test format::tests::test_format_mixed_case_key ... ok
test format::tests::test_format_preserves_comments ... ok
test format::tests::test_format_preserves_values ... ok
test format::tests::test_format_sorts_alphabetically ... ok
test format::tests::test_format_trims_whitespace ... ok
test format::tests::test_format_uppercase_keys ... ok
test parser::tests::test_empty_key_rejected ... ok
test parser::tests::test_invalid_line ... ok
test parser::tests::test_parse_empty_value ... ok
test parser::tests::test_parse_preserves_line_structure ... ok
test parser::tests::test_parse_quoted_values ... ok
test parser::tests::test_parse_simple_env ... ok
test parser::tests::test_parse_whitespace_handling ... ok
test schema::tests::test_schema_invalid_type ... ok
test schema::tests::test_schema_parsing ... ok
test schema::tests::test_schema_type_aliases ... ok
test schema::tests::test_validation_bool_case_insensitive ... ok
test schema::tests::test_validation_extra_key ... ok
test schema::tests::test_validation_missing_key ... ok
test schema::tests::test_validation_success ... ok
test schema::tests::test_validation_type_error_bool ... ok
test schema::tests::test_validation_type_error_int ... ok

test result: ok. 32 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out

running 12 tests
test test_check_extra_key_warning ... ok
test test_check_missing_key ... ok
test test_check_type_error ... ok
test test_check_valid_env ... ok
test test_diff_added_removed_changed ... ok
test test_diff_identical_files ... ok
test test_diff_redact ... ok
test test_format_in_place ... ok
test test_format_preserves_comments ... ok
test test_format_stdout ... ok
test test_help_flag ... ok
test test_version_flag ... ok

test result: ok. 12 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out
```

**Total: 44 tests passing âœ“**

---

## ğŸ“„ License

This project is licensed under the **MIT License** â€” see the [LICENSE](LICENSE) file for details.

---

## ğŸ¸ About

**envcraft** is developed by **LazyFrog** at [kindware.dev](https://kindware.dev).

- ğŸ“§ **Support:** [support@kindware.dev](mailto:support@kindware.dev)
- ğŸ™ **GitHub:** [github.com/Brutus1066/envcraft](https://github.com/Brutus1066/envcraft)
- ğŸŒ **Website:** [kindware.dev](https://kindware.dev)

---

<p align="center">
  <strong>ğŸ¸ LazyFrog | kindware.dev</strong><br>
  <em>Precise tools for .env files</em>
</p>
